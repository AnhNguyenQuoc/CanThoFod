<script>
      $(document).ready(function(){
            $(".lightgallery").lightGallery();
      })
</script>

<%= render 'layout_extends/header' %>


   <section class="main-restaurant" style="padding-top: 5%;">
            <div class="container" style="width: 80%">
                  <div class="row">
                        <div class="col m8 s12">
                              <nav>
                                    <div class="nav-wrapper" >
                                          <div class="col s12">
                                                <%= link_to "Home", root_path, class: "breadcrumb"%>
                                                <%= link_to "Cửa hàng", cua_hang_path, class: "breadcrumb"%>
                                                <a class="breadcrumb"><%= @restaurant.name %></a>
                                          </div>
                                    </div>
                              </nav>
                              <div class="main-restaurant-text">
                                    <h1><%= @restaurant.name%></h1>

                                    <div>
                                          <h6>Địa chỉ </h6><span><%= @restaurant.address %> - <%= @restaurant.district.name %> </span>
                                          <br />
                                          <h6>Phone</h6><span><%= @restaurant.phone %></span>
                                          <br />
                                          <h6>Loại</h6><span><%= @restaurant.restaurant_type.name %></span>
                                          <br />
                                          <% unless @restaurant.description.blank? %>
                                          <h6>Mô tả</h6><span><%= @restaurant.description%></span>
                                          <% end %>
                                    </div>
                              </div>
                        </div>
                        <div class="col m4 s12">
                              <div class="img-main-restaurant mt-2">
                                    <%= image_tag @restaurant.image, class: "responsive-img", style: "height: 300px"%>
                              </div>
                              <div class="img-main-restaurant-text">
                                    <span>Mở cửa từ</span>
                                    <br>
                                    <span><%= @restaurant.timeopen.strftime('%H:%M') %>  - <%= @restaurant.timeclose.strftime('%H:%M') %></span>
                              </div>
                        </div>
                  </div>
            </div>
      </section>

      <section class="comment">
            <div>
                  <div class="row">
                        <div class="col m6 offset-m2">
                              <h6 class="comment-text">Nhận xét</h6>
                        </div>
                  </div>
                  <div class="row">
                        <div class="col m2 s12">
                              <div class="collection fixed" id="main-menu">
                                    <%= link_to "Trang chủ", restaurant_trang_chu_path(@restaurant), class: "collection-item"%>
                                    <%= link_to "Đặt món", restaurant_dat_mon_path(@restaurant), class: "collection-item "%>
                                    <%= link_to "Nhận xét", restaurant_comment_path(@restaurant), class: "collection-item active"%>
                              </div>
                        </div>
                        <div class="col m8 s12" id="comments">
                                <div class="row">
                                    <div class="col s12">
                                          <ul class="tabs">
                                          <li class="tab col s3"><a class="active" href="#test1">Tất cả</a></li>
                                          <li class="tab col s3"><a  href="#test2">Của bạn</a></li>
                                          </ul>
                                    </div>
                                    <div id="test1" class="col s12">
                                          <%= render 'comment' %>
                                    </div>
                                    <div id="test2" class="col s12">
                                    <% if logged_in? %>
                                          <%if @your_comments.count > 0%>
                                                <% @your_comments.each do |comment| %>
                                                      <div class="card comment-card mb-2">
                                                            <div class="card-content">
                                                                  <h5 class="card-title">
                                                                        <%= comment.user.username%>
                                                                        <span style="float: right; background: red; padding: 10px; color: white; font-weight: bold;"><%= comment.rating %></span>
                                                                        <% if logged_in?%>
                                                                              <% if comment.user_id == current_user.id %>
                                                                              <span><%= link_to "<i class='material-icons'>delete</i>".html_safe, comment_destroy_path(comment), method: :delete, data: {confirm: "Bạn có chắc chắn chứ?"}%></span>
                                                                              <% end %>
                                                                        <% end %>
                                                                  </h5>
                                                                  <h6 class="card-subtitle mb-2 text-muted"><%= comment.created_at.strftime('%d/%m/%y - %Hh:%Mp:%Ss')%></h6>
                                                                  <div class="divider"></div>
                                                                  <br>
                                                                  <h6 class="text-flow"><%= link_to comment.restaurant.name, restaurant_dat_mon_path(comment.restaurant.id) %></h6>
                                                                  <br>
                                                                  <p class="card-text"><%= comment.description %></p>
                                                                  <br />
                                                                  <div class="img-container lightgallery">
                                                                  <% comment.images.each do |image| %>
                                                                        <a href='<%= rails_blob_url(image)%>'>
                                                                                    <%= image_tag image, alt: image.filename, height: "150", weight: "150" %>
                                                                        </a>
                                                                        <% end %>
                                                                  </div>
                                                            </div>
                                                      </div>
                                                <% end %>
                                          <% else %>
                                          <p class="text-flow">Bạn chưa có bất kỳ nhận xét nào!!</p>
                                          <% end %>
                                    <% end %>
                                    </div>
                              </div>
                        </div>
                        <div class="col m2 s12 btn-comment">
                              <% if logged_in? %>
                               <button data-target="nhanxet" class="waves-effect waves-light btn modal-trigger" style="width: 100%;">Viết nhận xét</button>
                               <% else %>
                              <a class="tooltipped secondary-content waves-effect waves-light btn " data-position="bottom" data-tooltip="Bạn vui lòng đăng nhập">Viết nhận xét</a>
                              <% end %>
                        
                              <!-- Modal Structure -->
                              <div id="nhanxet" class="modal" style="width: 80%">
                                    <div class="row">
                                          <div class="col s12 center-align" style="padding-top: 2%;">
                                                <h3 class="flow-text">Nhận xét</h3>
                                          </div>
                                          <%= form_for(@comment, url: comments_path(:restaurant_id => @restaurant.id), :html => {class: "col s8 offset-s2"}, remote: true)do |f| %>
                                                
                                                <div class="row">
                                                      <div class="input-field col s12">
                                                            <%= f.text_area :description, class: "materialize-textarea"%>
                                                            <%= f.label :description, "Nội dung" %>
                                                      </div>
                                                      <div class="input-field col s12">
                                                            <%= f.label :rating, "Điểm số"%>
                                                            <p class="range-field">
                                                                  <%= f.range_field :rating, :min => 0, :max => 10 %>
                                                            </p>
                                                      </div>
                                                      <div class="file-field input-field col">
                                                            <div class="btn">
                                                                  <span>Hình ảnh</span>
                                                                  <%= f.file_field :images, multiple: true, :onchange => 'previewFiles()' %>
                                                            </div>
                                                            <div class="file-path-wrapper">
                                                                  <input class="file-path validate" type="text">
                                                            </div>
                                                      </div>
                                                      <div class="file-field input-field col">
                                                             <div id="preview">
                                                            </div>
                                                      </div>
                                                      <div class="modal-footer">
                                                            <%= f.submit "Đăng nhận xét", :class => 'waves-effect waves-green btn-flat'%>
                                                      </div>
                                                </div>
                                          <% end %>
                                    </div>

                              </div>


                        </div>
                  </div>
            </div>
      </section>



<%= render 'layout_extends/footer' %>

<script>

      function previewFiles() {

  var preview = document.querySelector('#preview');
  var files   = document.querySelector('input[type=file]').files;

  function readAndPreview(file) {

    // Make sure `file.name` matches our extensions criteria
    if ( /\.(jpe?g|png|gif)$/i.test(file.name) ) {
      var reader = new FileReader();

      reader.addEventListener("load", function () {
        var image = new Image();
        image.height = 100;
        image.title = file.name;
        image.src = this.result;
        preview.appendChild( image );
      }, false);

      reader.readAsDataURL(file);
    }

  }

  if (files) {
    [].forEach.call(files, readAndPreview);
  }

}

             $(document).ready(function(){
                        if(screen.width < 1360){
                  $('#main-menu').removeClass('fixed');
            }
      })
            $(window).resize(function(){
             if(screen.width < 1360){
                  $('#main-menu').removeClass('fixed');
             }
      })
      
</script>